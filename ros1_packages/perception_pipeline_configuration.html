<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perception Configuration &mdash; Interbotix X-Series Arms Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
      <link rel="stylesheet" type="text/css" href="../_static/tr_style.css" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MoveIt Interface and API" href="moveit_interface_and_api.html" />
    <link rel="prev" title="MoveIt Configuration" href="moveit_motion_planning_configuration.html" />
   
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "nglikgkapv");
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  <div class="sidebartitle-docs-home">
    <a href="https://docs.trossenrobotics.com/" target="_blank" class="icon icon-home">
      &nbsp;Trossen Robotics Docs Home
    </a>
    <div class="sidebartitle-docs-home-hr">
      <hr>
    </div>
  </div>
  

          
          
          <a href="../index.html">
            
              <img src="../_static/logo_xsarms.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../specifications.html">Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros_interface.html">ROS Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_ros_interface.html">Python-ROS Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../matlab_ros_interface.html">MATLAB-ROS Interface</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../ros1_packages.html">ROS 1 Open Source Packages</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="arm_descriptions.html">Arm Descriptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="arm_control.html">Arm Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="gazebo_simulation_configuration.html">Gazebo Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="ros_control.html">ROS Controllers Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="moveit_motion_planning_configuration.html">MoveIt Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Perception Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#armtag-issues">ArmTag Issues</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#could-not-find-ar-tag-returning-a-zero-pose">Could not find AR Tag. Returning a ‘zero’ Pose…</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#pointcloud-filter-tuning-issues">PointCloud Filter Tuning Issues</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#incomplete-bulk-usb-transfer">Incomplete bulk usb transfer!</a></li>
<li class="toctree-l5"><a class="reference internal" href="#no-stream-match-for-pointcloud-chosen-texture-process-color">No stream match for pointcloud chosen texture Process - Color</a></li>
<li class="toctree-l5"><a class="reference internal" href="#no-clusters-found">No clusters found…</a></li>
<li class="toctree-l5"><a class="reference internal" href="#found-x-clusters-instead-of-y-clusters">Found ‘x’ clusters instead of ‘y’ clusters…</a></li>
<li class="toctree-l5"><a class="reference internal" href="#could-not-match-the-cluster-please-tune-the-filter-parameters-such-that-all-spherical-object-markers-are-constant-in-their-respective-clusters-and-do-not-flicker">Could not match the cluster. Please tune the filter parameters such that all spherical ‘object markers’ are constant in their respective clusters and do not flicker</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#video-tutorials">Video Tutorials</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#python-perception">Python Perception</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="moveit_interface_and_api.html">MoveIt Interface and API</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_demos.html">Python Demos</a></li>
<li class="toctree-l2"><a class="reference internal" href="matlab_demos.html">MATLAB Demos</a></li>
<li class="toctree-l2"><a class="reference internal" href="joystick_control.html">Joystick Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="record_and_playback.html">Record And Playback</a></li>
<li class="toctree-l2"><a class="reference internal" href="arm_diagnostic_tool.html">Arm Diagnostic Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="arm_diagnostic_listener.html">Arm Diagnostic Listener</a></li>
<li class="toctree-l2"><a class="reference internal" href="pid_gains_test_environment.html">PID Gains Test Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="arm_puppeteering.html">Arm Puppeteering</a></li>
<li class="toctree-l2"><a class="reference internal" href="dual_arm_control.html">Dual Arm Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="dual_arm_joystick_control.html">Dual Arm Joystick Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ros1_packages.html#contributing">Contributing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ros2_packages.html">ROS 2 Open Source Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Interbotix X-Series Manipulators Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../ros1_packages.html">ROS 1 Open Source Packages</a></li>
      <li class="breadcrumb-item active">Perception Configuration</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/TrossenRobotics/interbotix_xsarms_docs/blob/main/docs/ros1_packages/perception_pipeline_configuration.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="perception-configuration">
<h1>Perception Configuration<a class="headerlink" href="#perception-configuration" title="Permalink to this heading"></a></h1>
<a href="https://github.com/Interbotix/interbotix_ros_manipulators/tree/main/interbotix_ros_xsarms/interbotix_xsarm_perception"
    class="docs-view-on-github-button"
    target="_blank">
    <img src="../_static/GitHub-Mark-Light-32px.png"
        class="docs-view-on-github-button-gh-logo">
    View Package on GitHub
</a><div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>This package contains the necessary config and launch files to get any of the many Interbotix
X-Series arms working with the <a class="reference external" href="https://industrial-training-master.readthedocs.io/en/melodic/_source/session5/Building-a-Perception-Pipeline.html" rel="noopener noreferrer" target="_blank">perception pipeline</a>. The end result allows for an arm to pick up
any small, non-reflective object from a tabletop-type surface that is within a RealSense
color/depth camera’s field of view. While any Intel RealSense color/depth camera can be used, this
package was mainly tested with the <a class="reference external" href="https://www.intelrealsense.com/depth-camera-sr305/" rel="noopener noreferrer" target="_blank">SR305</a> and <a class="reference external" href="https://www.intelrealsense.com/depth-camera-d415/" rel="noopener noreferrer" target="_blank">D415</a> cameras. See more details on how the
pipeline works in the <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_toolboxes/tree/main/interbotix_perception_toolbox/interbotix_perception_modules" rel="noopener noreferrer" target="_blank">interbotix_perception_modules</a> ROS package. To purchase our vision kit
(which includes a D415 camera and stand), visit <a class="reference external" href="https://www.trossenrobotics.com/interbotix-arm-vision-kit.aspx" rel="noopener noreferrer" target="_blank">its store page</a>.</p>
</div>
<div class="section" id="structure">
<h2>Structure<a class="headerlink" href="#structure" title="Permalink to this heading"></a></h2>
<img alt="../_images/xsarm_perception_flowchart.png" class="align-center" src="../_images/xsarm_perception_flowchart.png" />
<p>As shown above, this package builds on top of the <cite>interbotix_xsarm_control</cite> and
<cite>interbotix_perception_modules</cite> packages. To get familiar with those packages, please refer to
their documentation. The other nodes are described below:</p>
<ul class="simple">
<li><strong>realsense2_camera_manager</strong> - nodelet manager to manage the camera nodelet below</li>
<li><strong>RealSenseNodeFactory</strong> - nodelet to create a ROS interface for the RealSense camera</li>
</ul>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h2>
<p>To work with this package, first build your stand and secure the RealSense camera on the 1/4 inch
screw at the top. Then place the stand in your work area and adjust the goose-neck or ball/socket
joint such that the camera is pointed towards your tabletop. Next, place some small, non-reflective
objects on the tabletop such that they are clearly visible to the camera and are reachable by the
arm. The objects should be small enough such that they can easily fit between the gripper fingers
on the robot arm no matter the gripper’s orientation. They can not be too reflective though as that
will interfere with the depth camera’s ability to locate them (as it uses infrared light).
Similarly, the workspace should not be in direct sunlight as that also interferes with the camera’s
depth sensing abilities. Otherwise, the arm, camera, and small objects can be arbitrarily placed.
For the <cite>pick and plate demo</cite>, you should setup your workspace area as shown below.</p>
<img alt="../_images/pick_place_demo_setup.png" class="align-center" src="../_images/pick_place_demo_setup.png" />
<p>Before the arm picks up any object, two things must be done. First, the camera must know where the
arm is relative to itself. One way of doing this is by manually measuring the offset from the
camera’s color optical frame to the robot’s <code class="docutils literal notranslate"><span class="pre">base_link</span></code> frame and publishing it as a static
transform. However, this is time consuming and prone to error. Instead, the <a class="reference external" href="https://github.com/AprilRobotics/apriltag_ros" rel="noopener noreferrer" target="_blank">apriltag_ros</a> ROS
package is used to find the transform of the AprilTag on the arm’s end-effector (looks like a
smiley face :P) relative to the camera’s color optical frame. Following this, the transform from
the camera’s color optical frame to the arm’s <code class="docutils literal notranslate"><span class="pre">base_link</span></code> frame is calculated and published as a
static transform.</p>
<p>To get that transform, run the following launch command in a terminal (assuming a WidowX-200 arm is
being used)…</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>roslaunch<span class="w"> </span>interbotix_xsarm_perception<span class="w"> </span>xsarm_perception.launch<span class="w"> </span>robot_model:<span class="o">=</span>wx200<span class="w"> </span>use_pointcloud_tuner_gui:<span class="o">=</span><span class="nb">true</span><span class="w"> </span>use_armtag_tuner_gui:<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p>RViz should pop up along with two standalone GUIs. One of those GUIs will look like the picture
below.</p>
<img alt="../_images/armtag_tuner_gui.png" class="align-center" src="../_images/armtag_tuner_gui.png" />
<p>Depending on how you setup your arm and camera in your workspace, the AprilTag on the arm may not
be visible to the camera. To make it visible, first torque off all the arm joints by opening a
terminal and typing…</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>rosservice<span class="w"> </span>call<span class="w"> </span>/wx200/torque_enable<span class="w"> </span><span class="s2">&quot;{cmd_type: &#39;group&#39;, name: &#39;arm&#39;, enable: false}&quot;</span>
</pre></div>
</div>
<p>Next, manually manipulate the arm such that the AprilTag is clearly visible to the camera (the live
video stream in the bottom left of the RViz display should help with that). Then in the same
terminal as before, torque the arm back on as follows…</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>rosservice<span class="w"> </span>call<span class="w"> </span>/wx200/torque_enable<span class="w"> </span><span class="s2">&quot;{cmd_type: &#39;group&#39;, name: &#39;arm&#39;, enable: true}&quot;</span>
</pre></div>
</div>
<p>Now, in the Armtag Tuner GUI, click the ‘Snap Pose’ button. Feel free to toggle up/down the number
of snapshots that should be taken. The poses calculated from the snapshots will then be averaged to
come up with a more accurate pose of where the arm is relative to the camera. One way to check the
accuracy of the calculated pose is to toggle the RawPointCloud display i n RViz. Hopefully, the
pointcloud version of the AprilTag should be located on (possibly a couple millimeters below) the
AR tag link of the virtual robot model. If it’s not, feel free to keep pressing the ‘Snap Pose’
button until it looks alright.</p>
<p>At this point, you should see a pointcloud version of your tabletop with the objects on it. If your
arm is in the way, just torque it off and move it to its Sleep pose (make sure to hold the arm
before torquing it off). Then, using the PointCloud Tuner GUI, tune the pointcloud parameters for
your specific use case. See <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_toolboxes/tree/main/interbotix_perception_toolbox/interbotix_perception_modules" rel="noopener noreferrer" target="_blank">this guide</a> for how to go about doing this. Don’t forget to save your
configs after tuning them!</p>
<p>Now you should be able to successfully run the <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_manipulators/blob/main/interbotix_ros_xsarms/interbotix_xsarm_perception/scripts/pick_place.py" rel="noopener noreferrer" target="_blank">pick_place.py</a> script. First make sure to edit the
robot name in the script to your robot model (if it’s not the WidowX 200 arm). You can also comment
out lines 18 and 25 - 28 that deal with getting the pose of the arm relative to the camera. As
you’ve already done this above, there’s no need to do it again. However, the code is there just in
case you’d rather snap the AR tag pose in a script rather than with the GUI.</p>
<p>While running the script, you should see a TF marker appear close to the top of each object’s
cluster (see the image below for clarification). This is where the camera believes the top of each
cluster to be, and is the position returned to the user from the <code class="docutils literal notranslate"><span class="pre">get_cluster_positions</span></code>
function. These TFs are temporary and will fade from RViz after a minute is up. The arm will then
line up its <code class="docutils literal notranslate"><span class="pre">ee_gripper_link</span></code> to be in the same spot as each of these cluster positions and
hopefully pick up the objects.</p>
<img alt="../_images/object_cluster_tf.png" class="align-center" src="../_images/object_cluster_tf.png" />
<p>After running the demo, <kbd class="kbd docutils literal notranslate">Ctrl</kbd> + <kbd class="kbd docutils literal notranslate">C</kbd> from the launch file. The ‘camera to arm base_link’
transform will automatically be saved in a file called ‘static_transforms.yaml’ in the <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_manipulators/blob/main/interbotix_ros_xsarms/interbotix_xsarm_perception/config" rel="noopener noreferrer" target="_blank">config</a>
directory. Now, you can run the demo script headless - first by typing…</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>roslaunch<span class="w"> </span>interbotix_xsarm_perception<span class="w"> </span>xsarm_perception.launch<span class="w"> </span>robot_model:<span class="o">=</span>wx200<span class="w"> </span>use_rviz:<span class="o">=</span><span class="nb">false</span>
</pre></div>
</div>
<p>Then head over to the <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_manipulators/blob/main/interbotix_ros_xsarms/interbotix_xsarm_perception/scripts" rel="noopener noreferrer" target="_blank">scripts</a> directory and running the <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_manipulators/blob/main/interbotix_ros_xsarms/interbotix_xsarm_perception/scripts/pick_place.py" rel="noopener noreferrer" target="_blank">pick_place.py</a> script.</p>
<p>For more info, check out the <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_toolboxes/tree/main/interbotix_perception_toolbox/interbotix_perception_modules/src/interbotix_perception_modules/armtag.py" rel="noopener noreferrer" target="_blank">Armtag</a> or <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_toolboxes/tree/main/interbotix_perception_toolbox/interbotix_perception_modules/src/interbotix_perception_modules/pointcloud.py" rel="noopener noreferrer" target="_blank">Pointcloud</a> Python APIs to reference the fully
documented functions.</p>
<p>Other launch file arguments for further customization can be seen below…</p>
<table border="1" class="colwidths-given docutils align-default">
<colgroup>
<col width="20%" />
<col width="60%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument</th>
<th class="head">Description</th>
<th class="head">Default Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>robot_model</td>
<td>model type of the Interbotix Arm such as ‘wx200’ or ‘rx150’</td>
<td>“”</td>
</tr>
<tr class="row-odd"><td>robot_name</td>
<td>name of the robot (typically equal to <code class="docutils literal notranslate"><span class="pre">robot_model</span></code>, but could be anything)</td>
<td>$(arg robot_model)</td>
</tr>
<tr class="row-even"><td>base_link_frame</td>
<td>name of the ‘root’ link on the arm; typically ‘base_link’, but can be changed if attaching the arm to a mobile base that already has a ‘base_link’ frame</td>
<td>base_link’</td>
</tr>
<tr class="row-odd"><td>show_gripper_bar</td>
<td>if true, the gripper_bar link is included in the ‘robot_description’ parameter; if false, the gripper_bar and finger links are not loaded to the parameter server. Set to false if you have a custom gripper attachment</td>
<td>true</td>
</tr>
<tr class="row-even"><td>show_gripper_fingers</td>
<td>if true, the gripper fingers are included in the ‘robot_description’ parameter; if false, the gripper finger links are not loaded to the parameter server. Set to false if you have custom gripper fingers</td>
<td>true</td>
</tr>
<tr class="row-odd"><td>external_urdf_loc</td>
<td>the file path to the custom urdf.xacro file that you would like to include in the Interbotix robot’s urdf.xacro file</td>
<td>“”</td>
</tr>
<tr class="row-even"><td>use_rviz</td>
<td>launches RViz</td>
<td>true</td>
</tr>
<tr class="row-odd"><td>load_configs</td>
<td>a boolean that specifies whether or not the initial register values (under the ‘motors’ heading) in a Motor Config file should be written to the motors; as the values being written are stored in each motor’s EEPROM (which means the values are retained even after a power cycle), this can be set to false after the first time using the robot. Setting to false also shortens the node startup time by a few seconds and preserves the life of the EEPROM</td>
<td>true</td>
</tr>
<tr class="row-even"><td>filters</td>
<td>types of RealSense camera filters to use (in this case, the ‘pointcloud’ filter is needed)</td>
<td>pointcloud</td>
</tr>
<tr class="row-odd"><td>color_fps</td>
<td>frame rate of the color images taken on the RealSense camera</td>
<td>30</td>
</tr>
<tr class="row-even"><td>depth_fps</td>
<td>frame rate of the depth images taken on the RealSense camera</td>
<td>30</td>
</tr>
<tr class="row-odd"><td>color_width</td>
<td>horizontal resolution of the color images taken on the RealSense camera</td>
<td>640</td>
</tr>
<tr class="row-even"><td>color_height</td>
<td>vertical resolution of the color images taken on the RealSense camera</td>
<td>480</td>
</tr>
<tr class="row-odd"><td>filter_ns</td>
<td>name-space where the pointcloud related nodes and parameters are located</td>
<td>pc_filter</td>
</tr>
<tr class="row-even"><td>filter_params</td>
<td>file location of the parameters used to tune the perception pipeline filters</td>
<td>refer to <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_manipulators/blob/main/interbotix_ros_xsarms/interbotix_xsarm_perception/launch/xsarm_perception.launch" rel="noopener noreferrer" target="_blank">xsarm_perception.launch</a></td>
</tr>
<tr class="row-odd"><td>use_pointcloud_tuner_gui</td>
<td>whether to show a GUI that a user can use to tune filter parameters</td>
<td>false</td>
</tr>
<tr class="row-even"><td>enable_pipeline</td>
<td>whether to enable the perception pipeline filters to run continuously; to save computer processing power, this should be set to False unless you are actively trying to tune the filter parameters; if False, the pipeline will only run if the <code class="docutils literal notranslate"><span class="pre">get_cluster_positions</span></code> ROS service is called</td>
<td>$(arg use_pointcloud_tuner_gui)</td>
</tr>
<tr class="row-odd"><td>cloud_topic</td>
<td>the absolute ROS topic name to subscribe to raw pointcloud data</td>
<td>/camera/depth/color/points</td>
</tr>
<tr class="row-even"><td>tag_family</td>
<td>family to which the AprilTag belongs</td>
<td>tagStandard41h12</td>
</tr>
<tr class="row-odd"><td>standalone_tags</td>
<td>individual AprilTags the algorithm should be looking for</td>
<td>refer to <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_toolboxes/tree/main/interbotix_perception_toolbox/interbotix_perception_modules" rel="noopener noreferrer" target="_blank">interbotix_perception_modules</a></td>
</tr>
<tr class="row-even"><td>camera_frame</td>
<td>the camera frame in which the AprilTag will be detected</td>
<td>camera_color_optical_frame</td>
</tr>
<tr class="row-odd"><td>apriltag_ns</td>
<td>name-space where the AprilTag related nodes and parameters are located</td>
<td>apriltag</td>
</tr>
<tr class="row-even"><td>camera_color_topic</td>
<td>the absolute ROS topic name to subscribe to color images</td>
<td>camera/color/image_raw</td>
</tr>
<tr class="row-odd"><td>camera_info_topic</td>
<td>the absolute ROS topic name to subscribe to the camera color info</td>
<td>camera/color/camera_info</td>
</tr>
<tr class="row-even"><td>armtag_ns</td>
<td>name-space where the Armtag related nodes and parameters are located</td>
<td>armtag</td>
</tr>
<tr class="row-odd"><td>ref_frame</td>
<td>the reference frame that the armtag node should use when publishing a static transform for where the arm is relative to the camera</td>
<td>$(arg camera_frame)</td>
</tr>
<tr class="row-even"><td>arm_base_frame</td>
<td>the child frame that the armtag node should use when publishing a static transform for where the arm is relative to the camera</td>
<td>$(arg robot_name)/$(arg base_link_frame)</td>
</tr>
<tr class="row-odd"><td>arm_tag_frame</td>
<td>name of the frame on the arm where the AprilTag is located (defined in the URDF usually)</td>
<td>$(arg robot_name)/ar_tag_link</td>
</tr>
<tr class="row-even"><td>use_armtag_tuner_gui</td>
<td>whether to show a GUI that a user can use to publish the ‘ref_frame’ to ‘arm_base_frame’ transform</td>
<td>false</td>
</tr>
<tr class="row-odd"><td>position_only</td>
<td>whether only the position component of the detected AprilTag pose should be used when calculating the ‘ref_frame’ to ‘arm_base_frame’ transform; this should only be set to true if a tf chain already exists connecting the camera and arm base_link frame, and you just want to use the AprilTag to refine the pose further</td>
<td>false</td>
</tr>
<tr class="row-even"><td>load_transforms</td>
<td>whether or not the <strong>static_trans_pub</strong> node should publish any poses stored in the static_transforms.yaml file at startup; this should only be set to false if a tf chain already exists connecting the camera and arm base_link frame (usually defined in a URDF), and you’d rather use that tf chain as opposed to the one specified in the static_transforms.yaml file</td>
<td>true</td>
</tr>
<tr class="row-odd"><td>transform_filepath</td>
<td>filepath to the static_transforms.yaml file used by the <strong>static_trans_pub</strong> node; if the file does not exist yet, this is where you’d like the file to be generated</td>
<td>refer to <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_manipulators/blob/main/interbotix_ros_xsarms/interbotix_xsarm_perception/launch/xsarm_perception.launch" rel="noopener noreferrer" target="_blank">xsarm_perception.launch</a></td>
</tr>
<tr class="row-even"><td>rviz_frame</td>
<td>desired ‘fixed frame’ in RViz</td>
<td>$(arg robot_name)/$(arg base_link_frame)</td>
</tr>
<tr class="row-odd"><td>rvizconfig</td>
<td>filepath to the RViz config file</td>
<td>refer to <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_manipulators/blob/main/interbotix_ros_xsarms/interbotix_xsarm_perception/launch/xsarm_perception.launch" rel="noopener noreferrer" target="_blank">xsarm_perception.launch</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading"></a></h2>
<p>Below are some common error messages, warnings, or issues you might see, and how to go about fixing
them.</p>
<div class="section" id="armtag-issues">
<h3>ArmTag Issues<a class="headerlink" href="#armtag-issues" title="Permalink to this heading"></a></h3>
<div class="section" id="could-not-find-ar-tag-returning-a-zero-pose">
<h4>Could not find AR Tag. Returning a ‘zero’ Pose…<a class="headerlink" href="#could-not-find-ar-tag-returning-a-zero-pose" title="Permalink to this heading"></a></h4>
<p>This warning occurs if the camera cannot see the AprilTag or if the wrong AprilTag is present. To
fix, make sure that the AprilTag is clearly visible to the camera when you try to ‘snap’ its pose.</p>
</div>
</div>
<div class="section" id="pointcloud-filter-tuning-issues">
<h3>PointCloud Filter Tuning Issues<a class="headerlink" href="#pointcloud-filter-tuning-issues" title="Permalink to this heading"></a></h3>
<div class="section" id="incomplete-bulk-usb-transfer">
<h4>Incomplete bulk usb transfer!<a class="headerlink" href="#incomplete-bulk-usb-transfer" title="Permalink to this heading"></a></h4>
<p>This is just a onetime error message that appears at launch when using the RealSense depth camera
camera. It’s nothing to be worried about and can be safely ignored.</p>
</div>
<div class="section" id="no-stream-match-for-pointcloud-chosen-texture-process-color">
<h4>No stream match for pointcloud chosen texture Process - Color<a class="headerlink" href="#no-stream-match-for-pointcloud-chosen-texture-process-color" title="Permalink to this heading"></a></h4>
<p>This is a warning that can appear occasionally (once every 5 minutes or so) when using a RealSense
camera. It just means that a frame was dropped during serial communication, but it’s nothing to
worry about and can be safely ignored.</p>
</div>
<div class="section" id="no-clusters-found">
<h4>No clusters found…<a class="headerlink" href="#no-clusters-found" title="Permalink to this heading"></a></h4>
<p>This warning is outputted by the <code class="docutils literal notranslate"><span class="pre">get_cluster_positions</span></code> function in the
InterbotixPointCloudInterface module if the algorithm could not find any clusters. Verify that you
have non-reflective objects within the field of view of the camera and that the CropBox filter is
not cutting them out. To check this, toggle on the ‘FilteredPointCloud’ display in RViz and see if
the pointcloud representation of your objects are showing up. If they are, it’s possible that you
need to lower the minimum cluster size threshold; turn on the ‘ObjectPointCloud’ and
‘ObjectMarkers’ displays and lower the Min Cluster Size parameter until you see small spheres at
the centroid of each of your clusters.</p>
</div>
<div class="section" id="found-x-clusters-instead-of-y-clusters">
<h4>Found ‘x’ clusters instead of ‘y’ clusters…<a class="headerlink" href="#found-x-clusters-instead-of-y-clusters" title="Permalink to this heading"></a></h4>
<p>This warning is outputted by the <code class="docutils literal notranslate"><span class="pre">get_cluster_positions</span></code> function in the
InterbotixPointCloudInterface module if the algorithm found a different number of clusters over
‘num_samples’ iterations (when compared to the first set of cluster positions received). Similar to
the ‘No clusters found…’ issue, this can be resolved by tuning the Min Cluster Size parameter
until the spherical object markers are steady and not flickering. This issue could also arise if
the spherical object markers are flickering due to two clusters being very near each other
(sometimes above or below the Cluster Tolerance threshold). To fix this, lower the cluster
tolerance threshold or physically move the two objects such that they are further away from each
other.</p>
</div>
<div class="section" id="could-not-match-the-cluster-please-tune-the-filter-parameters-such-that-all-spherical-object-markers-are-constant-in-their-respective-clusters-and-do-not-flicker">
<h4>Could not match the cluster. Please tune the filter parameters such that all spherical ‘object markers’ are constant in their respective clusters and do not flicker<a class="headerlink" href="#could-not-match-the-cluster-please-tune-the-filter-parameters-such-that-all-spherical-object-markers-are-constant-in-their-respective-clusters-and-do-not-flicker" title="Permalink to this heading"></a></h4>
<p>Most likely, you’ll never run into this issue; but if you do, the fixes suggested in the ‘Found x
clusters instead of y clusters…’ issue should resolve the problem. The issue essentially means
that the detected position of a cluster in a later iteration is vastly different than the detected
position of the cluster in an earlier iteration (over ‘num_samples’ iterations). It could arise if
the Object Markers are flickering, and it just happens that the same number number of clusters are
found, but the clusters are in different places. If working with an arm on a LoCoBot, another fix
is to give time (half a second or so) for the arm to settle before capturing the pointcloud data.
This is because the motion of the arm can cause the mobile base to wobble a bit - making the camera
move as well.</p>
</div>
</div>
</div>
<div class="section" id="video-tutorials">
<h2>Video Tutorials<a class="headerlink" href="#video-tutorials" title="Permalink to this heading"></a></h2>
<div class="section" id="python-perception">
<h3>Python Perception<a class="headerlink" href="#python-perception" title="Permalink to this heading"></a></h3>
<div class="video_wrapper align-center" style="padding-bottom: 39.375000%; padding-top: 30px; position: relative; text-align: center; width: 70%">
<iframe allowfullscreen="true" src="https://www.youtube.com/embed/03BZ6PLFOac" style="border: 0; height: 100%; left: 0; position: absolute; top: 0; width: 100%">
</iframe></div></div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="moveit_motion_planning_configuration.html" class="btn btn-neutral float-left" title="MoveIt Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="moveit_interface_and_api.html" class="btn btn-neutral float-right" title="MoveIt Interface and API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Trossen Robotics.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
     


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>