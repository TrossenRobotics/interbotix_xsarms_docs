<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gravity Compensation &mdash; Interbotix X-Series Arms Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
      <link rel="stylesheet" type="text/css" href="../_static/tr_style.css" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Troubleshooting" href="../troubleshooting.html" />
    <link rel="prev" title="Record And Playback" href="record_and_playback.html" />
   
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "nglikgkapv");
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  <div class="sidebartitle-docs-home">
    <a href="https://docs.trossenrobotics.com/" target="_blank" class="icon icon-home">
      &nbsp;Trossen Robotics Docs Home
    </a>
    <div class="sidebartitle-docs-home-hr">
      <hr>
    </div>
  </div>
  

          
          
          <a href="../index.html">
            
              <img src="../_static/logo_xsarms.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../specifications.html">Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros_interface.html">ROS Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_ros_interface.html">Python-ROS Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../matlab_ros_interface.html">MATLAB-ROS Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros1_packages.html">ROS 1 Open Source Packages</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../ros2_packages.html">ROS 2 Open Source Packages</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="arm_descriptions.html">Arm Descriptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="arm_control.html">Arm Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_configuration.html">Simulation Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="ros_control.html">ROS 2 Controllers Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="moveit_motion_planning_configuration.html">MoveIt 2 Motion Planning Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="perception_pipeline_configuration.html">Perception Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="moveit_interface_and_api.html">MoveIt2 Interface and API</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_demos.html">Python Demos</a></li>
<li class="toctree-l2"><a class="reference internal" href="joystick_control.html">Joystick Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="record_and_playback.html">Record And Playback</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Gravity Compensation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Interbotix X-Series Manipulators Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../ros2_packages.html">ROS 2 Open Source Packages</a></li>
      <li class="breadcrumb-item active">Gravity Compensation</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/TrossenRobotics/interbotix_xsarms_docs/blob/main/docs/ros2_packages/gravity_compensation.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="gravity-compensation">
<h1>Gravity Compensation<a class="headerlink" href="#gravity-compensation" title="Permalink to this heading"></a></h1>
<a href="https://github.com/Interbotix/interbotix_ros_manipulators/tree/humble/interbotix_ros_xsarms/examples/interbotix_xsarm_gravity_compensation"
    class="docs-view-on-github-button"
    target="_blank">
    <img src="../_static/GitHub-Mark-Light-32px.png"
        class="docs-view-on-github-button-gh-logo">
    View Package on GitHub
</a><div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>As its name suggests, gravity compensation cancels out the effect of the gravity on a system.
In our case, we compensate the gravity on an Interbotix arm with its joint motors.
This feature is useful when we use the arm as a teleoperation remote or when we teach it a specific trajectory and don’t want to keep holding the arm to avoid it from collapsing.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently supported arms include: WidowX-250 6DOF and ALOHA WidowX-250 6DOF.</p>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>The <strong>motor_specs.yaml</strong> contains the motor specifications and options for motor assistance and dithering.
A template file is given below</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Motor Assist: scale the no-load currents which alleviate the effects of friction</span>
<span class="c1"># If the values are invalid, they default to 0</span>
<span class="c1"># Joints not specified in the motor_assist or motor_specs sections</span>
<span class="c1"># do not support the current control mode</span>
<span class="nt">motor_assist</span><span class="p">:</span>
<span class="c1"># Set &#39;all&#39; to [0, 1] to scale the no load currents of all joints uniformly</span>
<span class="c1"># Or to -1 and use joint specific values</span>
<span class="nt">all</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span>
<span class="c1"># Set the joint specific values to [0, 1] to scale differently for each joint</span>
<span class="nt">waist</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="nt">shoulder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="nt">elbow</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="nt">forearm_roll</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="nt">wrist_angle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="nt">wrist_rotate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>

<span class="c1"># Dither: add a oscillatory motion proportional to the load to break static friction</span>
<span class="c1"># It is helpful when slow and smooth movements are needed</span>
<span class="c1"># WARNING: excessive dithering WILL cause heat and wear on the joints</span>
<span class="nt">dither</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="nt">motor_specs</span><span class="p">:</span>
<span class="nt">waist</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># torque constant (Nm/A): how much torque is produced per Amp of current</span>
<span class="w">    </span><span class="nt">torque_constant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.793</span>
<span class="w">    </span><span class="c1"># current unit (A): how much current command is needed to produce 1 Amp of current</span>
<span class="w">    </span><span class="nt">current_unit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.00269</span>
<span class="w">    </span><span class="c1"># no load current (A): the maximum no load current applied when motor_assist == 1</span>
<span class="w">    </span><span class="c1"># should be as large as possible without the joint accelerating by itself</span>
<span class="w">    </span><span class="nt">no_load_current</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">    </span><span class="c1"># kinetic friction (Nm/Nm): the kinetic friction coefficient</span>
<span class="w">    </span><span class="c1"># should be tuned so that the friction is uniform over the entire joint range</span>
<span class="w">    </span><span class="nt">kinetic_friction_coefficient</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">    </span><span class="c1"># static friction coefficient (Nm/Nm): the static friction coefficient</span>
<span class="w">    </span><span class="c1"># affects the amplitude of the dithering motion</span>
<span class="w">    </span><span class="nt">static_friction_coefficient</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">    </span><span class="c1"># dither speed (rad/s): the speed under which the joint dithers</span>
<span class="w">    </span><span class="nt">dither_speed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>

<span class="nt">shoulder</span><span class="p">:</span>
<span class="w">    </span><span class="nt">torque_constant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.793</span>
<span class="w">    </span><span class="nt">current_unit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.00269</span>
<span class="w">    </span><span class="nt">no_load_current</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">    </span><span class="nt">kinetic_friction_coefficient</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">    </span><span class="nt">static_friction_coefficient</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.4</span>
<span class="w">    </span><span class="nt">dither_speed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>

<span class="nt">elbow</span><span class="p">:</span>
<span class="w">    </span><span class="nt">torque_constant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.793</span>
<span class="w">    </span><span class="nt">current_unit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.00269</span>
<span class="w">    </span><span class="nt">no_load_current</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">    </span><span class="nt">kinetic_friction_coefficient</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">    </span><span class="nt">static_friction_coefficient</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.6</span>
<span class="w">    </span><span class="nt">dither_speed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>

<span class="nt">forearm_roll</span><span class="p">:</span>
<span class="w">    </span><span class="nt">torque_constant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.897</span>
<span class="w">    </span><span class="nt">current_unit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.00269</span>
<span class="w">    </span><span class="nt">no_load_current</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span>
<span class="w">    </span><span class="nt">kinetic_friction_coefficient</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">    </span><span class="nt">static_friction_coefficient</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">    </span><span class="nt">dither_speed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>

<span class="nt">wrist_angle</span><span class="p">:</span>
<span class="w">    </span><span class="nt">torque_constant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.897</span>
<span class="w">    </span><span class="nt">current_unit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.00269</span>
<span class="w">    </span><span class="nt">no_load_current</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">    </span><span class="nt">kinetic_friction_coefficient</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">    </span><span class="nt">static_friction_coefficient</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.4</span>
<span class="w">    </span><span class="nt">dither_speed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>

<span class="nt">wrist_rotate</span><span class="p">:</span>
<span class="w">    </span><span class="nt">torque_constant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.897</span>
<span class="w">    </span><span class="nt">current_unit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.00269</span>
<span class="w">    </span><span class="nt">no_load_current</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span>
<span class="w">    </span><span class="nt">kinetic_friction_coefficient</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">    </span><span class="nt">static_friction_coefficient</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">    </span><span class="nt">dither_speed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Excessive dithering WILL cause heat and wear on the joints.
Please use it with caution.</p>
</div>
</div>
<div class="section" id="structure">
<h2>Structure<a class="headerlink" href="#structure" title="Permalink to this heading"></a></h2>
<img alt="../_images/xsarm_gravity_compensation_flowchart_ros2.png" class="align-center" src="../_images/xsarm_gravity_compensation_flowchart_ros2.png" />
<p>As shown above, the <cite>interbotix_xsarm_gravity_compensation</cite> package builds on top of the <cite>interbotix_xsarm_control</cite> package whose details are given <a class="reference internal" href="arm_control.html"><span class="doc">here</span></a>.</p>
<p>This package contains a single node called <strong>gravity_compensation</strong>.
It subscribes to the <code class="docutils literal notranslate"><span class="pre">/&lt;robot_name&gt;/joint_states</span></code> topic, computes and publishes the desired current commands to the <code class="docutils literal notranslate"><span class="pre">/&lt;robot_name&gt;/commands/joint_group</span></code> topic.
Please refer to the GitHub <a class="reference external" href="interbotix_gravity_compensation" rel="noopener noreferrer" target="_blank">Readme</a> for more details on its derivations and implementation.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h2>
<p>Run the following launch command, assuming the Aloha WidowX-250 arm is being used:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ros2<span class="w"> </span>launch<span class="w"> </span>interbotix_xsarm_gravity_compensation<span class="w"> </span>interbotix_gravity_compensation.launch.py<span class="w"> </span>robot_model:<span class="o">=</span>aloha_wx250s
</pre></div>
</div>
<p>It runs the <code class="docutils literal notranslate"><span class="pre">gravity_compensation</span></code> node and launches the <code class="docutils literal notranslate"><span class="pre">xsarm_control</span></code> script to bring up the arm.</p>
<p>Then, enable/disable the gravity compensation with the following service call:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ros2<span class="w"> </span>service<span class="w"> </span>call<span class="w"> </span>/aloha_wx250s/gravity_compensation_enable<span class="w"> </span>std_srvs/srv/SetBool<span class="w"> </span><span class="s1">&#39;data: [true/false]&#39;</span>
</pre></div>
</div>
<p>The arm will hold itself against gravity and can be moved freely when the gravity compensation is enabled.
It will lock in its current position when the gravity compensation is disabled.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The arm WILL torque off and drop for a short period of time while enabling/disabling.
Please make sure it is in a resting position or manually held.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The joints not supporting current control WILL torque off.
Please make sure to use an arm with at least the first three joints supporting current control, e.g., RX, WX, VX series.</p>
</div>
<p>This is the bare minimum needed to get up and running. Take a look at the table below to see how to further customize with other launch file arguments.</p>
<table border="1" class="colwidths-given docutils align-default">
<colgroup>
<col width="17%" />
<col width="50%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument</th>
<th class="head">Description</th>
<th class="head">Default</th>
<th class="head">Choices</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>robot_model</td>
<td>model type of the Interbotix Arm.</td>
<td>&#160;</td>
<td><code class="docutils literal notranslate"><span class="pre">aloha_wx250s</span></code>, <code class="docutils literal notranslate"><span class="pre">wx250s</span></code></td>
</tr>
<tr class="row-odd"><td>robot_name</td>
<td>name of the robot (typically equal to <code class="docutils literal notranslate"><span class="pre">robot_model</span></code>, but could be anything).</td>
<td>LaunchConfig(<code class="docutils literal notranslate"><span class="pre">robot_model</span></code>)</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>motor_specs</td>
<td>the file path to the ‘motor specs’ YAML file.</td>
<td>LocalVar(‘FindPackageShare(pkg= <code class="docutils literal notranslate"><span class="pre">interbotix_xsarm_gravity_compensation</span></code>) + ‘config’ + ‘motor_specs_’’) + LaunchConfig(‘robot_model’) + ‘.yaml’</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="record_and_playback.html" class="btn btn-neutral float-left" title="Record And Playback" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../troubleshooting.html" class="btn btn-neutral float-right" title="Troubleshooting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Trossen Robotics.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
     


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>