<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perception Configuration &mdash; Interbotix X-Series Arms Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
      <link rel="stylesheet" type="text/css" href="../_static/tr_style.css" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MoveIt2 Interface and API" href="moveit_interface_and_api.html" />
    <link rel="prev" title="MoveIt 2 Motion Planning Configuration" href="moveit_motion_planning_configuration.html" />
   
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "nglikgkapv");
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  <div class="sidebartitle-docs-home">
    <a href="https://docs.trossenrobotics.com/" target="_blank" class="icon icon-home">
      &nbsp;Trossen Robotics Docs Home
    </a>
    <div class="sidebartitle-docs-home-hr">
      <hr>
    </div>
  </div>
  

          
          
          <a href="../index.html">
            
              <img src="../_static/logo_xsarms.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../specifications.html">Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros_interface.html">ROS Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_ros_interface.html">Python-ROS Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../matlab_ros_interface.html">MATLAB-ROS Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros1_packages.html">ROS 1 Open Source Packages</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../ros2_packages.html">ROS 2 Open Source Packages</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="arm_descriptions.html">Arm Descriptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="arm_control.html">Arm Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_configuration.html">Simulation Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="ros_control.html">ROS 2 Controllers Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="moveit_motion_planning_configuration.html">MoveIt 2 Motion Planning Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Perception Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#armtag-issues">ArmTag Issues</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#could-not-find-ar-tag-returning-a-zero-pose">Could not find AR Tag. Returning a ‘zero’ Pose…</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#pointcloud-filter-tuning-issues">PointCloud Filter Tuning Issues</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#incomplete-bulk-usb-transfer">Incomplete bulk usb transfer!</a></li>
<li class="toctree-l5"><a class="reference internal" href="#no-stream-match-for-pointcloud-chosen-texture-process-color">No stream match for pointcloud chosen texture Process - Color</a></li>
<li class="toctree-l5"><a class="reference internal" href="#no-clusters-found">No clusters found…</a></li>
<li class="toctree-l5"><a class="reference internal" href="#found-x-clusters-instead-of-y-clusters">Found ‘x’ clusters instead of ‘y’ clusters…</a></li>
<li class="toctree-l5"><a class="reference internal" href="#could-not-match-the-cluster-please-tune-the-filter-parameters-such-that-all-spherical-object-markers-are-constant-in-their-respective-clusters-and-do-not-flicker">Could not match the cluster. Please tune the filter parameters such that all spherical ‘object markers’ are constant in their respective clusters and do not flicker</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="moveit_interface_and_api.html">MoveIt2 Interface and API</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_demos.html">Python Demos</a></li>
<li class="toctree-l2"><a class="reference internal" href="joystick_control.html">Joystick Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="record_and_playback.html">Record And Playback</a></li>
<li class="toctree-l2"><a class="reference internal" href="gravity_compensation.html">Gravity Compensation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Interbotix X-Series Manipulators Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../ros2_packages.html">ROS 2 Open Source Packages</a></li>
      <li class="breadcrumb-item active">Perception Configuration</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/TrossenRobotics/interbotix_xsarms_docs/blob/main/docs/ros2_packages/perception_pipeline_configuration.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="perception-configuration">
<h1>Perception Configuration<a class="headerlink" href="#perception-configuration" title="Permalink to this heading"></a></h1>
<a href="https://github.com/Interbotix/interbotix_ros_manipulators/tree/rolling/interbotix_ros_xsarms/interbotix_xsarm_perception"
    class="docs-view-on-github-button"
    target="_blank">
    <img src="../_static/GitHub-Mark-Light-32px.png"
        class="docs-view-on-github-button-gh-logo">
    View Package on GitHub
</a><div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>This package contains the necessary config and launch files to get any of the many Interbotix
X-Series arms working with any of the Interbotix <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_toolboxes/tree/rolling/interbotix_perception_toolbox/interbotix_perception_pipelines" rel="noopener noreferrer" target="_blank">perception pipelines</a>. The end result allows for
an arm to pick up any small, non-reflective object from a tabletop-type surface that is within a
RealSense color/depth camera’s field of view. While any Intel RealSense color/depth camera can be
used, this package was mainly tested with the <a class="reference external" href="https://www.intelrealsense.com/depth-camera-d415/" rel="noopener noreferrer" target="_blank">D415</a> camera. See more details on how the pipeline
works in the <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_toolboxes/tree/rolling/interbotix_perception_toolbox/interbotix_perception_modules" rel="noopener noreferrer" target="_blank">interbotix_perception_modules</a> ROS package. To purchase our vision kit (which
includes a D415 camera and stand), visit <a class="reference external" href="https://www.trossenrobotics.com/interbotix-arm-vision-kit.aspx" rel="noopener noreferrer" target="_blank">its store page</a>.</p>
</div>
<div class="section" id="structure">
<h2>Structure<a class="headerlink" href="#structure" title="Permalink to this heading"></a></h2>
<img alt="../_images/xsarm_perception_flowchart_ros2.png" class="align-center" src="../_images/xsarm_perception_flowchart_ros2.png" />
<p>As shown above, this package builds on top of the <cite>interbotix_xsarm_control</cite> and
<cite>interbotix_perception_modules</cite> packages. To get familiar with those packages, please refer to
their documentation. The other nodes are described below:</p>
<ul class="simple">
<li><strong>realsense2_camera_manager</strong> - nodelet manager to manage the camera nodelet below</li>
<li><strong>RealSenseNodeFactory</strong> - nodelet to create a ROS interface for the RealSense camera</li>
</ul>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h2>
<p>To work with this package, first build your stand and secure the RealSense camera on the 1/4 inch
screw at the top. Then place the stand in your work area and adjust the goose-neck or ball/socket
joint such that the camera is pointed towards your tabletop. Next, place some small, non-reflective
objects on the tabletop such that they are clearly visible to the camera and are reachable by the
arm. The objects should be small enough such that they can easily fit between the gripper fingers
on the robot arm no matter the gripper’s orientation. They can not be too reflective though as that
will interfere with the depth camera’s ability to locate them through its use of infrared light.
Similarly, the workspace should not be in direct sunlight as that also interferes with the camera’s
depth sensing abilities. Otherwise, the arm, camera, and small objects can be arbitrarily placed.
For the <cite>pick and place demo</cite>, you should setup your workspace area as shown below.</p>
<img alt="../_images/pick_place_demo_setup1.png" class="align-center" src="../_images/pick_place_demo_setup1.png" />
<p>Before the arm picks up any object, two things must be done. First, the camera must know where the
arm is relative to itself. One way of doing this is by manually measuring the offset from the
camera’s color optical frame to the robot’s <code class="docutils literal notranslate"><span class="pre">base_link</span></code> frame and publishing it as a static
transform. However, this is time consuming and prone to error. Instead, the <a class="reference external" href="https://github.com/Interbotix/apriltag_ros/tree/ros2-port" rel="noopener noreferrer" target="_blank">apriltag_ros</a> ROS 2
package is used to find the transform of the AprilTag visual fiducial marker on the arm’s
end-effector relative to the camera’s color optical frame. Following this, the transform from the
camera’s color optical frame to the arm’s <code class="docutils literal notranslate"><span class="pre">base_link</span></code> frame is calculated and published as a
static transform.</p>
<p>To get that transform, run the following launch command in a terminal (assuming a WidowX-200 arm is
being used)…</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ros2<span class="w"> </span>launch<span class="w"> </span>interbotix_xsarm_perception<span class="w"> </span>xsarm_perception.launch.py<span class="w"> </span>robot_model:<span class="o">=</span>wx200<span class="w"> </span>use_pointcloud_tuner_gui:<span class="o">=</span><span class="nb">true</span><span class="w"> </span>use_armtag_tuner_gui:<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p>RViz should pop up along with two standalone GUIs. One of those GUIs will look like the picture
below.</p>
<img alt="../_images/armtag_tuner_gui1.png" class="align-center" src="../_images/armtag_tuner_gui1.png" />
<p>Depending on how you setup your arm and camera in your workspace, the AprilTag on the arm may not
be visible to the camera. To make it visible, first torque off all the arm joints by opening a
terminal and typing…</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ros2<span class="w"> </span>service<span class="w"> </span>call<span class="w"> </span>/wx200/torque_enable<span class="w"> </span>interbotix_xs_msgs/srv/TorqueEnable<span class="w"> </span><span class="s2">&quot;{cmd_type: &#39;group&#39;, name: &#39;arm&#39;, enable: false}&quot;</span>
</pre></div>
</div>
<p>Next, manually manipulate the arm such that the AprilTag is clearly visible to the camera (the live
video stream in the bottom left of the RViz display should help with that). Then in the same
terminal as before, torque the arm back on as follows…</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ros2<span class="w"> </span>service<span class="w"> </span>call<span class="w"> </span>/wx200/torque_enable<span class="w"> </span>interbotix_xs_msgs/srv/TorqueEnable<span class="w"> </span><span class="s2">&quot;{cmd_type: &#39;group&#39;, name: &#39;arm&#39;, enable: true}&quot;</span>
</pre></div>
</div>
<p>Now, in the Armtag Tuner GUI, click the ‘Snap Pose’ button. Feel free to toggle up/down the number
of snapshots that should be taken. The poses calculated from the snapshots will then be averaged to
come up with a more accurate pose of where the arm is relative to the camera. One way to check the
accuracy of the calculated pose is to toggle the RawPointCloud display in RViz. Hopefully, the
pointcloud version of the AprilTag should be located on (possibly a couple millimeters below) the
AR tag link of the virtual robot model. If it’s not, feel free to keep pressing the ‘Snap Pose’
button until it looks alright.</p>
<p>At this point, you should see a pointcloud version of your tabletop with the objects on it. If your
arm is in the way, just torque it off and move it to its Sleep pose (make sure to hold the arm
before torquing it off). Then, using the PointCloud Tuner GUI, tune the pointcloud parameters for
your specific use case. See <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_toolboxes/tree/rolling/interbotix_perception_toolbox/interbotix_perception_modules" rel="noopener noreferrer" target="_blank">this guide</a> for how to go about doing this. Don’t forget to save your
configs after tuning them!</p>
<p>Now you should be able to successfully run the <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_manipulators/blob/rolling/interbotix_ros_xsarms/interbotix_xsarm_perception/demos/pick_place.py" rel="noopener noreferrer" target="_blank">pick and place demo</a> script. First make sure to
edit the robot name in the script to your robot model (if it’s not the WidowX-200 arm). You can
also comment out line 76 that deals with getting the pose of the arm relative to the camera. As
you’ve already done this above, there’s no need to do it again. However, the code is there just in
case you’d rather snap the AR tag pose in a script rather than with the GUI.</p>
<p>While running the script, you should see a TF marker appear close to the top of each object’s
cluster (see the image below for clarification). This is where the camera believes the top of each
cluster to be, and is the position returned to the user from the <code class="docutils literal notranslate"><span class="pre">get_cluster_positions</span></code>
function. These TFs are temporary and will fade from RViz after a minute is up. The arm will then
line up its <code class="docutils literal notranslate"><span class="pre">ee_gripper_link</span></code> to be in the same spot as each of these cluster positions and
hopefully pick up the objects.</p>
<img alt="../_images/object_cluster_tf1.png" class="align-center" src="../_images/object_cluster_tf1.png" />
<p>After running the demo, <kbd class="kbd docutils literal notranslate">Ctrl</kbd> + <kbd class="kbd docutils literal notranslate">C</kbd> from the launch file. The ‘camera to arm base_link’
transform will automatically be saved in a file called ‘static_transforms.yaml’ in the <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_manipulators/blob/rolling/interbotix_ros_xsarms/interbotix_xsarm_perception/config" rel="noopener noreferrer" target="_blank">config</a>
directory. Now, you can run the demo script headless - first by running the command below.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ros2<span class="w"> </span>launch<span class="w"> </span>interbotix_xsarm_perception<span class="w"> </span>xsarm_perception.launch.py<span class="w"> </span>robot_model:<span class="o">=</span>wx200<span class="w"> </span>use_rviz:<span class="o">=</span><span class="nb">false</span>
</pre></div>
</div>
<p>Then head over to the <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_manipulators/blob/rolling/interbotix_ros_xsarms/interbotix_xsarm_perception/demos" rel="noopener noreferrer" target="_blank">demos</a> directory and running the <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_manipulators/blob/rolling/interbotix_ros_xsarms/interbotix_xsarm_perception/demos/pick_place.py" rel="noopener noreferrer" target="_blank">pick and place demo</a> script.</p>
<p>For more info, check out the <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_toolboxes/blob/rolling/interbotix_perception_toolbox/interbotix_perception_modules/interbotix_perception_modules/armtag.py" rel="noopener noreferrer" target="_blank">Armtag</a> or <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_toolboxes/blob/rolling/interbotix_perception_toolbox/interbotix_perception_modules/interbotix_perception_modules/pointcloud.py" rel="noopener noreferrer" target="_blank">Pointcloud</a> Python APIs to reference the fully
documented functions.</p>
<p>Other launch file arguments for further customization can be seen below…</p>
<table border="1" class="colwidths-given docutils align-default">
<colgroup>
<col width="17%" />
<col width="50%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument</th>
<th class="head">Description</th>
<th class="head">Default</th>
<th class="head">Choices</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>robot_model</td>
<td>One of: (‘px100’, ‘px150’, ‘rx150’, ‘rx200’, ‘wx200’, ‘wx250’, ‘wx250s’, ‘vx250’, ‘vx300’, ‘vx300s’, ‘mobile_px100’, ‘mobile_wx200’, ‘mobile_wx250s’)</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>robot_name</td>
<td>name of the robot (typically equal to <code class="docutils literal notranslate"><span class="pre">robot_model</span></code>, but could be anything)</td>
<td>LaunchConfig(<code class="docutils literal notranslate"><span class="pre">robot_model</span></code>)</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>base_link_frame</td>
<td>name of the ‘root’ link on the arm; typically <code class="docutils literal notranslate"><span class="pre">base_link</span></code>, but can be changed if attaching the arm to a mobile base that already has a <code class="docutils literal notranslate"><span class="pre">base_link</span></code> frame.</td>
<td><code class="docutils literal notranslate"><span class="pre">base_link</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>use_gripper</td>
<td>if <code class="docutils literal notranslate"><span class="pre">true</span></code>, the default gripper is included in the <code class="docutils literal notranslate"><span class="pre">robot_description</span></code> parameter; if <code class="docutils literal notranslate"><span class="pre">false</span></code>, it is left out; set to <code class="docutils literal notranslate"><span class="pre">false</span></code> if not using the default gripper.</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-even"><td>show_ar_tag</td>
<td>if <code class="docutils literal notranslate"><span class="pre">true</span></code>, the AR tag mount is included in the <code class="docutils literal notranslate"><span class="pre">robot_description</span></code> parameter; if <code class="docutils literal notranslate"><span class="pre">false</span></code>, it is left out; set to <code class="docutils literal notranslate"><span class="pre">true</span></code> if using the AR tag mount in your project.</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-odd"><td>show_gripper_bar</td>
<td>if <code class="docutils literal notranslate"><span class="pre">true</span></code>, the gripper_bar link is included in the <code class="docutils literal notranslate"><span class="pre">robot_description</span></code> parameter; if <code class="docutils literal notranslate"><span class="pre">false</span></code>, the gripper_bar and finger links are not loaded. Set to <code class="docutils literal notranslate"><span class="pre">false</span></code> if you have a custom gripper attachment.</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-even"><td>show_gripper_fingers</td>
<td>if true, the gripper fingers are included in the <code class="docutils literal notranslate"><span class="pre">robot_description</span></code> parameter; if <code class="docutils literal notranslate"><span class="pre">false</span></code>, the gripper finger links are not loaded. Set to <code class="docutils literal notranslate"><span class="pre">false</span></code> if you have custom gripper fingers.</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-odd"><td>use_world_frame</td>
<td>set this to <code class="docutils literal notranslate"><span class="pre">true</span></code> if you would like to load a ‘world’ frame to the <code class="docutils literal notranslate"><span class="pre">robot_description</span></code> parameter which is located exactly at the ‘base_link’ frame of the robot; if using multiple robots or if you would like to attach the ‘base_link’ frame of the robot to a different frame, set this to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</td>
<td><code class="docutils literal notranslate"><span class="pre">false</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-even"><td>external_urdf_loc</td>
<td>the file path to the custom urdf.xacro file that you would like to include in the Interbotix robot’s urdf.xacro file.</td>
<td>‘’</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>hardware_type</td>
<td>configures the <code class="docutils literal notranslate"><span class="pre">robot_description</span></code> parameter to use the actual hardware, fake hardware, or hardware simulated in Gazebo.</td>
<td><code class="docutils literal notranslate"><span class="pre">actual</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">actual</span></code>, <code class="docutils literal notranslate"><span class="pre">fake</span></code>, <code class="docutils literal notranslate"><span class="pre">gz_classic</span></code></td>
</tr>
<tr class="row-even"><td>robot_description</td>
<td>URDF of the robot; this is typically generated by the xacro command.</td>
<td>Command(FindExec(<code class="docutils literal notranslate"><span class="pre">xacro</span></code>) + ‘ ‘ + LocalVar(‘FindPackageShare(pkg= <code class="docutils literal notranslate"><span class="pre">interbotix_xsarm_descriptions</span></code>) + ‘urdf’ + LaunchConfig(<code class="docutils literal notranslate"><span class="pre">robot_model</span></code>)’) + ‘.urdf.xacro ‘ + ‘robot_name:=’ + LaunchConfig(<code class="docutils literal notranslate"><span class="pre">robot_name</span></code>) + ‘ ‘ + ‘base_link_frame:=’ + LaunchConfig(<code class="docutils literal notranslate"><span class="pre">base_link_frame</span></code>) + ‘ ‘ + ‘use_gripper:=’ + LaunchConfig(<code class="docutils literal notranslate"><span class="pre">use_gripper</span></code>) + ‘ ‘ + ‘show_ar_tag:=’ + LaunchConfig(<code class="docutils literal notranslate"><span class="pre">show_ar_tag</span></code>) + ‘ ‘ + ‘show_gripper_bar:=’ + LaunchConfig(<code class="docutils literal notranslate"><span class="pre">show_gripper_bar</span></code>) + ‘ ‘ + ‘show_gripper_fingers:=’ + LaunchConfig(<code class="docutils literal notranslate"><span class="pre">show_gripper_fingers</span></code>) + ‘ ‘ + ‘use_world_frame:=’ + LaunchConfig(<code class="docutils literal notranslate"><span class="pre">use_world_frame</span></code>) + ‘ ‘ + ‘external_urdf_loc:=’ + LaunchConfig(<code class="docutils literal notranslate"><span class="pre">external_urdf_loc</span></code>) + ‘ ‘ + ‘hardware_type:=’ + LaunchConfig(<code class="docutils literal notranslate"><span class="pre">hardware_type</span></code>) + ‘ ‘)</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>load_configs</td>
<td>a boolean that specifies whether or not the initial register values (under the ‘motors’ heading) in a Motor Config file should be written to the motors; as the values being written are stored in each motor’s EEPROM (which means the values are retained even after a power cycle), this can be set to false after the first time using the robot. Setting to false also shortens the node startup time by a few seconds and preserves the life of the EEPROM</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-even"><td>rs_camera_pointcloud_enable</td>
<td>enables the RealSense camera’s pointcloud.</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-odd"><td>rbg_camera_profile</td>
<td>profile for the rbg camera image stream, in <code class="docutils literal notranslate"><span class="pre">&lt;width&gt;x&lt;height&gt;x&lt;fps&gt;</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">640x480x30</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>depth_module_profile</td>
<td>profile for the depth module stream, in <code class="docutils literal notranslate"><span class="pre">&lt;width&gt;x&lt;height&gt;x&lt;fps&gt;</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">640x480x30</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>rs_camera_logging_level</td>
<td>set the logging level for the realsense2_camera launch include</td>
<td><code class="docutils literal notranslate"><span class="pre">info</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">debug</span></code>, <code class="docutils literal notranslate"><span class="pre">info</span></code>, <code class="docutils literal notranslate"><span class="pre">warn</span></code>, <code class="docutils literal notranslate"><span class="pre">error</span></code>, <code class="docutils literal notranslate"><span class="pre">fatal</span></code></td>
</tr>
<tr class="row-even"><td>rs_camera_output_location</td>
<td>set the logging location for the realsense2_camera launch include</td>
<td><code class="docutils literal notranslate"><span class="pre">screen</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">screen</span></code>, <code class="docutils literal notranslate"><span class="pre">log</span></code></td>
</tr>
<tr class="row-odd"><td>rs_camera_initial_reset</td>
<td>On occasions the RealSense camera is not closed properly and due to firmware issues needs to reset. If set to <code class="docutils literal notranslate"><span class="pre">true</span></code>, the device will reset prior to usage.</td>
<td><code class="docutils literal notranslate"><span class="pre">false</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-even"><td>filter_ns</td>
<td>namespace where the pointcloud related nodes and parameters are located</td>
<td><code class="docutils literal notranslate"><span class="pre">pc_filter</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>filter_params</td>
<td>file location of the parameters used to tune the perception pipeline filters</td>
<td>LocalVar(‘FindPackageShare(pkg= <code class="docutils literal notranslate"><span class="pre">interbotix_xsarm_perception</span></code>) + ‘config’ + ‘filter_params.yaml’’)</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>use_pointcloud_tuner_gui</td>
<td>whether to show a GUI that a user can use to tune filter parameters</td>
<td><code class="docutils literal notranslate"><span class="pre">false</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-odd"><td>enable_pipeline</td>
<td>whether to enable the perception pipeline filters to run continuously; to save computer processing power, this should be set to <code class="docutils literal notranslate"><span class="pre">false</span></code> unless you are actively trying to tune the filter parameters; if <code class="docutils literal notranslate"><span class="pre">false</span></code>, the pipeline will only run if the <code class="docutils literal notranslate"><span class="pre">get_cluster_positions</span></code> ROS service is called.</td>
<td>LaunchConfig(<code class="docutils literal notranslate"><span class="pre">use_pointcloud_tuner_gui</span></code>)</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-even"><td>cloud_topic</td>
<td>the absolute ROS topic name to subscribe to raw pointcloud data</td>
<td>‘/camera/depth/color/points’</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>tags_config</td>
<td>parameter file location for the AprilTag configuration</td>
<td>LocalVar(‘FindPackageShare(pkg= <code class="docutils literal notranslate"><span class="pre">interbotix_perception_modules</span></code>) + ‘config’ + ‘tags.yaml’’)</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>camera_frame</td>
<td>the camera frame in which the AprilTag will be detected</td>
<td><code class="docutils literal notranslate"><span class="pre">camera_color_optical_frame</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>apriltag_ns</td>
<td>namespace where the AprilTag related nodes and parameters are located</td>
<td><code class="docutils literal notranslate"><span class="pre">apriltag</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>camera_color_topic</td>
<td>the absolute ROS topic name to subscribe to color images</td>
<td>‘camera/color/image_raw’</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>camera_info_topic</td>
<td>the absolute ROS topic name to subscribe to the camera color info</td>
<td>‘camera/color/camera_info’</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>armtag_ns</td>
<td>name-space where the Armtag related nodes and parameters are located</td>
<td><code class="docutils literal notranslate"><span class="pre">armtag</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>ref_frame</td>
<td>the reference frame that the armtag node should use when publishing a static transform for where the arm is relative to the camera</td>
<td>LaunchConfig(<code class="docutils literal notranslate"><span class="pre">camera_frame</span></code>)</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>arm_base_frame</td>
<td>the child frame that the armtag node should use when publishing a static transform for where the arm is relative to the camera</td>
<td>LaunchConfig(<code class="docutils literal notranslate"><span class="pre">robot_name</span></code>) + ‘/’ + LaunchConfig(<code class="docutils literal notranslate"><span class="pre">base_link_frame</span></code>)</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>arm_tag_frame</td>
<td>name of the frame on the arm where the AprilTag is located (typically defined in the URDF)</td>
<td>LaunchConfig(<code class="docutils literal notranslate"><span class="pre">robot_name</span></code>) + ‘/’ + ‘ar_tag_link’</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>use_armtag_tuner_gui</td>
<td>whether to show a GUI that a user can use to publish the <code class="docutils literal notranslate"><span class="pre">ref_frame</span></code> to <code class="docutils literal notranslate"><span class="pre">arm_base_frame</span></code> transform</td>
<td><code class="docutils literal notranslate"><span class="pre">false</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-odd"><td>position_only</td>
<td>whether only the position component of the detected AprilTag pose should be used when calculating the <code class="docutils literal notranslate"><span class="pre">ref_frame</span></code> to <code class="docutils literal notranslate"><span class="pre">arm_base_frame</span></code> transform; this should only be set to <code class="docutils literal notranslate"><span class="pre">true</span></code> if a TF chain already exists connecting the camera and arm base_link frame, and you just want to use the AprilTag to refine the pose further</td>
<td><code class="docutils literal notranslate"><span class="pre">false</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-even"><td>load_transforms</td>
<td>whether or not the static_trans_pub node should publish any poses stored in the static_transforms.yaml file at startup; this should only be set to <code class="docutils literal notranslate"><span class="pre">false</span></code> if a TF chain already exists connecting the camera and arm base_link frame (typically defined in a URDF), and you would rather use that TF chain as opposed to the one specified in the static_transforms.yaml file</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-odd"><td>transform_filepath</td>
<td>filepath to the static_transforms.yaml file used by the static_trans_pub node; if the file does not exist yet, this is where you wouldd like the file to be generated</td>
<td>LocalVar(‘FindPackageShare(pkg= <code class="docutils literal notranslate"><span class="pre">interbotix_xsarm_perception</span></code>) + ‘config’ + ‘static_transforms.yaml’’)</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>use_rviz</td>
<td>launches RViz if set to <code class="docutils literal notranslate"><span class="pre">true</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-odd"><td>rviz_frame</td>
<td>desired <code class="docutils literal notranslate"><span class="pre">fixed</span> <span class="pre">frame</span></code> in RViz</td>
<td>LaunchConfig(<code class="docutils literal notranslate"><span class="pre">robot_name</span></code>) + ‘/’ + LaunchConfig(<code class="docutils literal notranslate"><span class="pre">base_link_frame</span></code>)</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>rvizconfig</td>
<td>filepath to the RViz config file</td>
<td>LocalVar(‘FindPackageShare(pkg= <code class="docutils literal notranslate"><span class="pre">interbotix_xsarm_perception</span></code>) + ‘rviz’ + ‘xsarm_perception.rviz’’)</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading"></a></h2>
<p>Below are some common error messages, warnings, or issues you might see, and how to go about fixing
them.</p>
<div class="section" id="armtag-issues">
<h3>ArmTag Issues<a class="headerlink" href="#armtag-issues" title="Permalink to this heading"></a></h3>
<div class="section" id="could-not-find-ar-tag-returning-a-zero-pose">
<h4>Could not find AR Tag. Returning a ‘zero’ Pose…<a class="headerlink" href="#could-not-find-ar-tag-returning-a-zero-pose" title="Permalink to this heading"></a></h4>
<p>This warning occurs if the camera cannot see the AprilTag or if the wrong AprilTag is present. To
fix, make sure that the AprilTag is clearly visible to the camera when you try to ‘snap’ its pose.</p>
</div>
</div>
<div class="section" id="pointcloud-filter-tuning-issues">
<h3>PointCloud Filter Tuning Issues<a class="headerlink" href="#pointcloud-filter-tuning-issues" title="Permalink to this heading"></a></h3>
<div class="section" id="incomplete-bulk-usb-transfer">
<h4>Incomplete bulk usb transfer!<a class="headerlink" href="#incomplete-bulk-usb-transfer" title="Permalink to this heading"></a></h4>
<p>This is just a onetime error message that appears at launch when using the RealSense depth camera
camera. It’s nothing to be worried about and can be safely ignored.</p>
</div>
<div class="section" id="no-stream-match-for-pointcloud-chosen-texture-process-color">
<h4>No stream match for pointcloud chosen texture Process - Color<a class="headerlink" href="#no-stream-match-for-pointcloud-chosen-texture-process-color" title="Permalink to this heading"></a></h4>
<p>This is a warning that can appear occasionally (once every 5 minutes or so) when using a RealSense
camera. It just means that a frame was dropped during serial communication, but it’s nothing to
worry about and can be safely ignored.</p>
</div>
<div class="section" id="no-clusters-found">
<h4>No clusters found…<a class="headerlink" href="#no-clusters-found" title="Permalink to this heading"></a></h4>
<p>This warning is outputted by the <code class="docutils literal notranslate"><span class="pre">get_cluster_positions</span></code> function in the
InterbotixPointCloudInterface module if the algorithm could not find any clusters. Verify that you
have non-reflective objects within the field of view of the camera and that the CropBox filter is
not cutting them out. To check this, toggle on the ‘FilteredPointCloud’ display in RViz and see if
the pointcloud representation of your objects are showing up. If they are, it’s possible that you
need to lower the minimum cluster size threshold; turn on the ‘ObjectPointCloud’ and
‘ObjectMarkers’ displays and lower the Min Cluster Size parameter until you see small spheres at
the centroid of each of your clusters.</p>
</div>
<div class="section" id="found-x-clusters-instead-of-y-clusters">
<h4>Found ‘x’ clusters instead of ‘y’ clusters…<a class="headerlink" href="#found-x-clusters-instead-of-y-clusters" title="Permalink to this heading"></a></h4>
<p>This warning is outputted by the <code class="docutils literal notranslate"><span class="pre">get_cluster_positions</span></code> function in the
InterbotixPointCloudInterface module if the algorithm found a different number of clusters over
‘num_samples’ iterations (when compared to the first set of cluster positions received). Similar to
the ‘No clusters found…’ issue, this can be resolved by tuning the Min Cluster Size parameter
until the spherical object markers are steady and not flickering. This issue could also arise if
the spherical object markers are flickering due to two clusters being very near each other
(sometimes above or below the Cluster Tolerance threshold). To fix this, lower the cluster
tolerance threshold or physically move the two objects such that they are further away from each
other.</p>
</div>
<div class="section" id="could-not-match-the-cluster-please-tune-the-filter-parameters-such-that-all-spherical-object-markers-are-constant-in-their-respective-clusters-and-do-not-flicker">
<h4>Could not match the cluster. Please tune the filter parameters such that all spherical ‘object markers’ are constant in their respective clusters and do not flicker<a class="headerlink" href="#could-not-match-the-cluster-please-tune-the-filter-parameters-such-that-all-spherical-object-markers-are-constant-in-their-respective-clusters-and-do-not-flicker" title="Permalink to this heading"></a></h4>
<p>Most likely, you’ll never run into this issue; but if you do, the fixes suggested in the ‘Found x
clusters instead of y clusters…’ issue should resolve the problem. The issue essentially means
that the detected position of a cluster in a later iteration is vastly different than the detected
position of the cluster in an earlier iteration (over ‘num_samples’ iterations). It could arise if
the Object Markers are flickering, and it just happens that the same number number of clusters are
found, but the clusters are in different places. If working with an arm on a Locobot, another fix
is to give time (half a second or so) for the arm to settle before capturing the pointcloud data.
This is because the motion of the arm can cause the Kobuki base to wobble a bit - making the camera
move as well.</p>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="moveit_motion_planning_configuration.html" class="btn btn-neutral float-left" title="MoveIt 2 Motion Planning Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="moveit_interface_and_api.html" class="btn btn-neutral float-right" title="MoveIt2 Interface and API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Trossen Robotics.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
     


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>